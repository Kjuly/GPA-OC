jQuery.uiTableEdit=function(jq,options){function unbind(){return jq.find(options.find).die('dblclick.uiTableEdit');}options=options||{};options.find=options.find||'tbody > tr > td';if(options.off){unbind().find('form').each(function(){var f=$(this);f.parents("td:first").text(f.find(':text').attr('value'));f.remove();});return jq;}function bind_mouse_down(mouseDn){unbind().live('dblclick.uiTableEdit',mouseDn);}function td_edit(){var td=jQuery(this);function restore(e){var val=td.find(':text').attr('value');if(options.dataVerify){var value=options.dataVerify.call(this,val,orig_text,e,td);if(value===false){return false;}if(value!==null&&value!==undefined)val=value;}td.html("");td.text(val);td.css({padding:'5px 0 0 5px',color:'#f00',font:'12px',width:'auto'});if(options.editDone)options.editDone(val,orig_text,e,td);bind_mouse_down(td_edit_wrapper);}var orig_text=td.text();var w=td.width();var h=td.height();var new_css={width:w+"px",height:h+"px",padding:"0",margin:"0"};td.css(new_css);td.html('<form name="td-editor" action="javascript:void(0);">'+'<input type="text" name="td_edit" value="'+td.text()+'"'+' style="margin:0;padding:10px;border:0px;width: '+w+'px;">'+'</input></form>').keypress(function(e){if(e.keyCode==13){restore(e);return false;}});function focus_text(){td.find('input:text').get(0).focus();}setTimeout(focus_text,50);bind_mouse_down(restore);}var td_edit_wrapper=!options.mouseDown?td_edit:function(){if(options.mouseDown.apply(this,arguments)==false)return false;td_edit.apply(this,arguments);};bind_mouse_down(td_edit_wrapper);return jq;}
